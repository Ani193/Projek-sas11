<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Data Pemesanan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    h2 { text-align: center; font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; }
    tr, th, td {
      border: 2px solid rgb(71, 69, 69);
      text-align: center;
      vertical-align: middle;
    }
    img.bukti-member {
      max-width: 100px;
      height: auto;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h2>Data Penyewa Alat Camping</h2>
    <table class="table table-info table-striped mt-5">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Kontak</th>
          <th>Detail Pesanan</th>
          <th>Total Bayar</th>
          <th>Bukti Member</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="dataPenyewa"></tbody>
    </table>
  </div>

  <!-- Modal Edit -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Data Penyewa</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="editForm">
            <input type="hidden" id="editIndex" />
            <div class="mb-2">
              <label>Nama</label>
              <input type="text" id="editNama" class="form-control" required />
            </div>
            <div class="mb-2">
              <label>Email</label>
              <input type="email" id="editEmail" class="form-control" required />
            </div>
            <div class="mb-2">
              <label>Telepon</label>
              <input type="text" id="editTelepon" class="form-control" required />
            </div>
            <div class="mb-2">
              <label>Alamat</label>
              <input type="text" id="editAlamat" class="form-control" required />
            </div>
            <div class="mb-2">
              <label>Tanggal Mulai</label>
              <input type="date" id="editTanggalMulai" class="form-control" required />
            </div>
            <div class="mb-2">
              <label>Tanggal Kembali</label>
              <input type="date" id="editTanggalKembali" class="form-control" required />
            </div>
            <div class="mb-2">
              <label>Metode Pembayaran</label>
              <select id="editMetodePembayaran" class="form-control" required>
                <option>Transfer Bank</option>
                <option>E-Wallet</option>
                <option>COD</option>
              </select>
            </div>
            <div class="mb-2">
              <label>Status Membership</label>
              <select id="editMembership" class="form-control" required>
                <option>Biasa</option>
                <option>Member</option>
              </select>
            </div>
            <div class="mb-2">
              <label>Alat Camping</label>
              <div>
                <label><input type="checkbox" class="edit-alat" value="Tenda kapasitas 4 Orang : Rp50000"> Tenda kapasitas 4 Orang : Rp50.000</label>
                <label><input type="checkbox" class="edit-alat" value="Tenda kapasitas 6 Orang : Rp70000"> Tenda kapasitas 6 Orang : Rp70.000</label>
                <label><input type="checkbox" class="edit-alat" value="Kompor Portable : Rp65000"> Kompor Portable (Belum Termasuk gas) : Rp65.000</label>
                <label><input type="checkbox" class="edit-alat" value="Matras Alumunium : Rp30000"> Matras Alumunium  : Rp30.000</label>
                <label><input type="checkbox" class="edit-alat" value="Matras Spon : Rp10000"> Matras Spon : Rp10.000</label>
                <label><input type="checkbox" class="edit-alat" value="Sleeping Bag : Rp185000"> Sleeping Bag : Rp185.000</label>
                <label><input type="checkbox" class="edit-alat" value="Gas Portable : Rp12000"> Gas Portable : Rp12.000</label>
                <label><input type="checkbox" class="edit-alat" value="Day Pack : Rp85000"> Day Pack (Belum Termasuk Coverbag) : Rp85.000</label>
                <label><input type="checkbox" class="edit-alat" value="Coverbag Ransel : Rp15000"> Coverbag Ransel : Rp15.000</label>
                <label><input type="checkbox" class="edit-alat" value="Headlamp Kecil : Rp25000"> Headlamp Kecil : Rp25.000</label>
                <label><input type="checkbox" class="edit-alat" value="Raincoat : Rp45000"> Raincoat : Rp45.000</label>
                <label><input type="checkbox" class="edit-alat" value="Trekking Pole : Rp50000"> Trekking Pole : Rp50.000</label>
                <label><input type="checkbox" class="edit-alat" value="Kursi Lipat : Rp25000"> Kursi Lipat : Rp25.000</label>
                <label><input type="checkbox" class="edit-alat" value="Peredit-alatan Masak : Rp150000"> Peredit-alatan Masak : Rp150.000</label>
                <label><input type="checkbox" class="edit-alat" value="Carrier Bag : Rp150000"> Carrier Bag : Rp150.000</label>
                <label><input type="checkbox" class="edit-alat" value="Lampu Tenda : Rp45000"> Lampu Tenda : Rp45.000</label>
                <label><input type="checkbox" class="edit-alat" value="Kompas : Rp25000"> Kompas : Rp25.000</label>
                <label><input type="checkbox" class="edit-alat" value="Senter : Rp25000"> Senter : Rp25.000</label>
              </div>
            </div>
            <div class="mb-2">
              <label>Paket Penyewaan</label>
              <div>
                <label><input type="checkbox" class="edit-paket" value="Pemula : Rp315000"> Paket Pemula : Rp315.000 <br>(Tenda kap. 2 orang, Matras spon, Sleeping bag, Lampu tenda, Kompas) - disewa selama 2 hari 1 malam</label><br>
                <label><input type="checkbox" class="edit-paket" value="Keluarga : Rp537000"> Paket Keluarga : Rp537.000 <br>(Tenda kap.6 orang, Matras spon, Sleeping bag, Kompor portable, Peralatan masak, Lampu tenda, Gas portable) - disewa selama 2 hari 1 malam</label><br>
                <label><input type="checkbox" class="edit-paket" value="Lengkap : Rp852000"> Paket Lengkap : Rp852.000 <br>(Tenda kap.6 orang, Sleeping bag, Matras alumunium, Matras spon, Kompor portable, Gas portable, Lampu tenda, Peralatan masak, Carrier bag, Day pack, Cover bag, Headlamp kecil, Kompas, Trekking pole, Kursi lipat, Rain coat) - disewa selama 2 hari 1 malam</label>
            </div>
            <div class="mb-2">
              <label>Total Bayar</label>
              <input type="text" id="editTotalBayar" class="form-control" readonly />
            </div>
            <div class="text-center">
              <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const alatPrices = {
      "Tenda kapasitas 4 Orang : Rp50000": 50000,
      "Tenda kapasitas 6 Orang : Rp70000": 70000,
      "Kompor Portable : Rp65000": 65000,
      "Matras Alumunium : Rp30000": 30000,
      "Matras Spon : Rp10000": 10000,
      "Sleeping Bag : Rp185000": 185000,
      "Gas Portable : Rp12000": 12000,
      "Day Pack : Rp85000": 85000,
      "Coverbag Ransel : Rp15000": 15000,
      "Headlamp Kecil : Rp25000": 25000,
      "Raincoat : Rp45000":45000,
      "Trekking Pole : Rp50000": 50000,
      "Kursi Lipat : Rp25000": 25000,
      "Peralatan Masak : Rp150000": 150000,
      "Lampu Tenda : Rp45000": 45000,
      "Kompas : Rp25000": 25000,
      "Senter : Rp25000": 25000
      
    };
    const paketPrices = {
      "Pemula : Rp315000": 315000,
      "Keluarga : Rp537000": 537000,
      "Lengkap : Rp852000": 852000
    };

    function loadDataPenyewaan() {
      const data = JSON.parse(localStorage.getItem('dataPenyewaan')) || [];
      const tbody = document.getElementById('dataPenyewa');
      tbody.innerHTML = '';

      data.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${item.nama}</td>
          <td>${item.telepon}<br>${item.email}</td>
          <td>
            <strong>Alat:</strong> ${item.alat.join(', ') || '-'}<br>
            <strong>Paket:</strong> ${item.paket.join(', ') || '-'}<br>
            <strong>Tanggal Mulai:</strong> ${item.tanggalMulai}<br>
            <strong>Tanggal Kembali:</strong> ${item.tanggalKembali}<br>
            <strong>Status:</strong> ${item.membership}
          </td>
          <td>${item.totalBayar}</td>
          <td>
            ${item.fotoMember ? `<img src="${item.fotoMember}" class="bukti-member">` : 'Tidak Ada'}
          </td>
          <td>
            <button class="btn btn-warning btn-sm" onclick="editData(${index})">Edit</button>
            <button class="btn btn-danger btn-sm" onclick="hapusData(${index})">Hapus</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editData(index) {
      const data = JSON.parse(localStorage.getItem('dataPenyewaan')) || [];
      const item = data[index];
      document.getElementById('editIndex').value = index;
      document.getElementById('editNama').value = item.nama;
      document.getElementById('editEmail').value = item.email;
      document.getElementById('editTelepon').value = item.telepon;
      document.getElementById('editAlamat').value = item.alamat;
      document.getElementById('editTanggalMulai').value = item.tanggalMulai;
      document.getElementById('editTanggalKembali').value = item.tanggalKembali;
      document.getElementById('editMetodePembayaran').value = item.metodePembayaran;
      document.getElementById('editMembership').value = item.membership;

      document.querySelectorAll('.edit-alat').forEach(input => {
        input.checked = item.alat.includes(input.value);
      });
      document.querySelectorAll('.edit-paket').forEach(input => {
        input.checked = item.paket.includes(input.value);
      });

      updateTotalEdit();
      const modal = new bootstrap.Modal(document.getElementById('editModal'));
      modal.show();
    }

    function updateTotalEdit() {
      let total = 0;
      document.querySelectorAll('.edit-alat:checked').forEach(el => {
        total += alatPrices[el.value] || 0;
      });
      document.querySelectorAll('.edit-paket:checked').forEach(el => {
        total += paketPrices[el.value] || 0;
      });
      document.getElementById('editTotalBayar').value = `Rp${total.toLocaleString()}`;
    }

    document.querySelectorAll('.edit-alat, .edit-paket').forEach(input => {
      input.addEventListener('change', updateTotalEdit);
    });

    document.getElementById('editForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const index = document.getElementById('editIndex').value;
      const data = JSON.parse(localStorage.getItem('dataPenyewaan')) || [];

      const selectedAlat = [];
      document.querySelectorAll('.edit-alat:checked').forEach(input => {
        selectedAlat.push(input.value);
      });

      const selectedPaket = [];
      document.querySelectorAll('.edit-paket:checked').forEach(input => {
        selectedPaket.push(input.value);
      });

      const total = calculateTotal(selectedAlat, selectedPaket);

      data[index] = {
        ...data[index],
        nama: document.getElementById('editNama').value,
        email: document.getElementById('editEmail').value,
        telepon: document.getElementById('editTelepon').value,
        alamat: document.getElementById('editAlamat').value,
        tanggalMulai: document.getElementById('editTanggalMulai').value,
        tanggalKembali: document.getElementById('editTanggalKembali').value,
        metodePembayaran: document.getElementById('editMetodePembayaran').value,
        membership: document.getElementById('editMembership').value,
        alat: selectedAlat,
        paket: selectedPaket,
        totalBayar: `Rp${total.toLocaleString()}`
      };

      localStorage.setItem('dataPenyewaan', JSON.stringify(data));
      loadDataPenyewaan();

      const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
      modal.hide();
    });

    function calculateTotal(alatArr, paketArr) {
      let total = 0;
      alatArr.forEach(a => total += alatPrices[a] || 0);
      paketArr.forEach(p => total += paketPrices[p] || 0);
      return total;
    }

    function hapusData(index) {
      if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
        const data = JSON.parse(localStorage.getItem('dataPenyewaan')) || [];
        data.splice(index, 1);
        localStorage.setItem('dataPenyewaan', JSON.stringify(data));
        loadDataPenyewaan();
      }
    }

    document.addEventListener('DOMContentLoaded', loadDataPenyewaan);
  </script>
</body>
</html>